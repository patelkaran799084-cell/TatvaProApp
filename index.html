<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tatva OS Pro</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#263646" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <!-- TOP BAR -->
  <div class="topbar">
    <div class="brand">
      <span class="dot"></span>
      <span class="title">Tatva OS Pro</span>
    </div>

    <div class="actions" id="topActions">
      <!-- âœ… Business switch (Only businesses matching login email will show) -->
      <select id="bizSelect" class="btn-top" onchange="switchBusinessFromUI()"></select>

      <!-- âœ… ADMIN only -->
      <button id="btnBiz" class="btn-top" style="display:none;" onclick="openBusinessMgr()">ğŸ¢ Business</button>

      <button class="btn-top" onclick="openTeamMgr()">ğŸ‘¥ Team</button>
      <button class="btn-top" onclick="openCategoryMgr()">ğŸ—‚ Category</button>

      <!-- DRIVE -->
      <button class="btn-top" onclick="driveLogin()">ğŸ” Drive Login</button>
      <button class="btn-top" onclick="backupToDrive(collectAppBackupData())">â˜ Backup</button>
      <button class="btn-top" onclick="restoreFromDrive()">â˜ Restore</button>

      <!-- LOCAL -->
      <button class="btn-top" onclick="backupData()">â¬‡ Save</button>
      <label class="btn-top" style="cursor:pointer;">
        â¬† Load
        <input type="file" accept=".json" style="display:none" onchange="restoreData(this)" />
      </label>
    </div>
  </div>

  <!-- DRIVE STATUS -->
  <div id="driveStatus" style="font-size:12px;color:#ddd;margin:6px 14px;">
    Drive: Not connected
  </div>

  <!-- âœ… LOGIN LOCK SCREEN -->
  <div id="loginLock" style="display:none;min-height:75vh;align-items:center;justify-content:center;flex-direction:column;">
    <div style="background:#fff;padding:16px 18px;border-radius:16px;max-width:420px;width:92%;box-shadow:0 8px 24px rgba(0,0,0,.12);text-align:center;">
      <h2 style="margin:8px 0;color:#263646;">ğŸ” Login Required</h2>
      <p style="margin:0 0 12px;color:#666;line-height:1.5;">
        App use karva mate pehla <b>Drive Login</b> required che.
        Login pachhi tamaru business auto open thase.
      </p>
      <button class="btn btn-blue" style="width:100%;padding:10px 12px;font-size:16px;" onclick="driveLogin()">
        ğŸ” Drive Login
      </button>
      <div style="margin-top:10px;font-size:12px;color:#888;">
        Admin: patelkaran799084@gmail.com
      </div>
    </div>
  </div>

  <!-- DASHBOARD -->
  <div class="container" id="mainApp">
    <div class="stats">
      <div class="stat-card"><div id="st-orders">0</div><small>Orders</small></div>
      <div class="stat-card"><div id="st-profit">â‚¹0</div><small>Net Profit</small></div>
      <div class="stat-card"><div id="st-rev">â‚¹0</div><small>Revenue</small></div>
      <div class="stat-card"><div id="st-hand">â‚¹0</div><small>Cash Hand</small></div>
    </div>

    <h3 class="section-title">RECENT ORDERS</h3>
    <div id="orders-list"></div>
  </div>

  <!-- FAB -->
  <button class="fab" id="fabBtn" onclick="openNewOrder()">+</button>

  <!-- NEW ORDER MODAL -->
  <div id="modal-new" class="modal">
    <div class="modal-box">
      <h3>New Order</h3>
      <input id="new-client" placeholder="Client Name" />
      <input id="new-work" placeholder="Work Details" />
      <input id="new-price" type="number" placeholder="Price" />
      <input id="new-date" type="date" />
      <div class="row">
        <button class="btn btn-blue" onclick="createOrder()">Create</button>
        <button class="btn" onclick="closeModal('modal-new')">Cancel</button>
      </div>
    </div>
  </div>

  <!-- ORDER DETAILS MODAL -->
  <div id="modal-detail" class="modal">
    <div class="modal-box big">

      <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:8px;">
        <h3 style="margin:0;">Order Details</h3>
        <button class="btn btn-red btn-sm" onclick="deleteOrder()">Delete</button>
      </div>

      <div class="row-inputs" style="margin-bottom:10px;">
        <select id="orderSelect" onchange="onOrderSelectChange()"></select>
        <button class="btn btn-blue btn-sm" onclick="openNewOrder()">+ New</button>
      </div>

      <div class="strip">
        <div><small>Client</small><b id="d-client">-</b></div>
        <div><small>Work</small><b id="d-work">-</b></div>
        <div><small>Date</small><b id="d-date">-</b></div>
      </div>

      <div class="strip" style="margin-top:10px;">
        <div><small>Received</small><b id="d-recd">â‚¹0</b></div>
        <div><small>Paid Out</small><b id="d-paid">â‚¹0</b></div>
        <div><small>Cash Hand</small><b id="d-hand">â‚¹0</b></div>
      </div>

      <div id="d-pending" class="pending"></div>

      <!-- Tabs -->
      <div style="display:flex;gap:8px;margin:12px 0;">
        <button class="btn btn-sm" onclick="switchTab('income')">ğŸ’° Income</button>
        <button class="btn btn-sm" onclick="switchTab('expense')">ğŸ§¾ Expense</button>
        <button class="btn btn-sm" onclick="switchTab('summary')">ğŸ“Œ Summary</button>
      </div>

      <!-- TAB: INCOME -->
      <div id="tab-income">
        <h4 style="margin:10px 0 6px;">Income</h4>
        <div class="row-inputs">
          <input id="pay-in-date" type="date" />
          <input id="pay-in-amt" type="number" placeholder="Amount" />
          <button class="btn btn-blue btn-sm" onclick="addIncome()">Add</button>
        </div>
        <div id="list-income"></div>
      </div>

      <!-- TAB: EXPENSE -->
      <div id="tab-expense" style="display:none;">
        <h4 style="margin:10px 0 6px;">Expenses / Tasks</h4>
        <div class="row-inputs">
          <select id="task-type"></select>
          <select id="task-artist"></select>
          <input id="task-cost" type="number" placeholder="Cost" />
          <button class="btn btn-blue btn-sm" onclick="addTask()">Add</button>
        </div>
        <div style="font-size:12px;color:#666;margin-top:6px;">
          Category add/remove â†’ Top bar "ğŸ—‚ Category"
        </div>
        <div id="list-tasks"></div>
      </div>

      <!-- TAB: SUMMARY -->
      <div id="tab-summary" style="display:none;">
        <h4 style="margin:10px 0 6px;">Payment History</h4>
        <details style="background:#fff;border:1px solid #eee;border-radius:12px;padding:10px;margin-top:8px;">
          <summary style="cursor:pointer;font-weight:800;">Client Income History</summary>
          <div id="hist-income" style="margin-top:10px;"></div>
        </details>
        <details style="background:#fff;border:1px solid #eee;border-radius:12px;padding:10px;margin-top:10px;">
          <summary style="cursor:pointer;font-weight:800;">Task Payments History</summary>
          <div id="hist-expense" style="margin-top:10px;"></div>
        </details>
      </div>

      <div class="row" style="margin-top:14px;">
        <button class="btn btn-green" onclick="markDone()">Auto Settle</button>
        <button class="btn" onclick="closeModal('modal-detail')">Close</button>
      </div>
    </div>
  </div>

  <!-- TEAM MODAL -->
  <div id="overlay-team" class="overlay" style="display:none;">
    <div class="modal-box">
      <h3>Team</h3>
      <div id="list-team"></div>
      <div class="row-inputs">
        <input id="team-new" placeholder="New Member" />
        <button class="btn btn-blue btn-sm" onclick="addTeam()">Add</button>
      </div>
      <div class="row">
        <button class="btn" onclick="document.getElementById('overlay-team').style.display='none'">Close</button>
      </div>
    </div>
  </div>

  <!-- CATEGORY MODAL -->
  <div id="overlay-cat" class="overlay" style="display:none;">
    <div class="modal-box">
      <h3>Task Categories</h3>
      <div id="list-cat"></div>
      <div class="row-inputs">
        <input id="cat-new" placeholder="New Category" />
        <button class="btn btn-blue btn-sm" onclick="addCategory()">Add</button>
      </div>
      <div class="row">
        <button class="btn" onclick="document.getElementById('overlay-cat').style.display='none'">Close</button>
      </div>
    </div>
  </div>

  <!-- âœ… BUSINESS MANAGER (ADMIN PIN) -->
  <div id="overlay-biz" class="overlay" style="display:none;">
    <div class="modal-box">
      <h3>Business Manager (Admin)</h3>

      <div id="biz-info" style="font-size:12px;color:#666;margin-bottom:8px;"></div>

      <div class="row-inputs">
        <input id="biz-pin" type="password" inputmode="numeric" placeholder="Admin PIN" />
        <button class="btn btn-blue btn-sm" onclick="unlockBizAdmin()">Unlock</button>
      </div>

      <div id="biz-panel" style="display:none;margin-top:12px;">
        <h4 style="margin:0 0 8px;">Allowed Emails</h4>
        <div id="biz-list"></div>

        <h4 style="margin:14px 0 6px;">Add Allowed Email</h4>
        <div class="row-inputs">
          <input id="biz-new-owner" placeholder="Email (bhai gmail)" />
          <button class="btn btn-green btn-sm" onclick="addBusiness()">Add</button>
        </div>
      </div>
    </div>

  <script src="gdrive.js"></script>
  <script src="app.js"></script>
</body>
</html>
