<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tatva OS Pro</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#263646" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <!-- TOP BAR -->
  <div class="topbar">
    <div class="brand">
      <span class="dot"></span>
      <span class="title">Tatva OS Pro</span>
      <div id="driveStatus" style="font-size:12px; opacity:0.85; margin-top:2px;">
        Drive: âŒ Not connected
      </div>
    </div>

    <div class="actions" id="topActions">

      <!-- âœ… Business switch -->
      <select id="bizSelect" class="btn-top" onchange="switchBusinessFromUI()"></select>

      <!-- âœ… ADMIN only -->
      <button id="btnBiz" class="btn-top" style="display:none;" onclick="openBusinessMgr()">ğŸ¢ Business</button>

      <button class="btn-top" onclick="openTeamMgr()">ğŸ‘¥ Team</button>
      <button class="btn-top" onclick="openCategoryMgr()">ğŸ—‚ Category</button>

      <!-- âœ… DRIVE (Updated) -->
      <button id="btnDriveLogin" class="btn-top" onclick="driveLogin()">ğŸ” Drive Login</button>
      <button id="btnDriveLogout" class="btn-top" style="display:none;" onclick="driveLogout()">ğŸšª Drive Logout</button>

      <button class="btn-top" onclick="backupToDrive(collectAppBackupData())">â˜ Backup</button>
      <button class="btn-top" onclick="restoreFromDrive()">â˜ Restore</button>

      <!-- LOCAL -->
      <button class="btn-top" onclick="backupData()">â¬‡ Save</button>

      <label class="btn-top" style="cursor:pointer;">
        â¬† Load
        <input type="file" accept=".json" style="display:none" onchange="restoreDataFromFile(event)" />
      </label>

    </div>
  </div>


  <!-- MAIN CONTAINER -->
  <div class="container">

    <!-- LOGIN REQUIRED OVERLAY -->
    <div id="loginOverlay" class="overlay" style="display:none;">
      <div class="modal">
        <div class="big" style="margin-bottom:8px;">ğŸ”’ Login Required</div>
        <div style="font-size:13px; color:#444; margin-bottom:12px;">
          App use karva mate pehla Drive Login required che.<br/>
          Login pachhi tamaru business auto open thase.
        </div>
        <button class="btn" onclick="driveLogin()">ğŸ” Drive Login</button>
        <div id="adminEmailHint" style="font-size:12px;color:#666;margin-top:10px;"></div>
      </div>
    </div>


    <!-- STATS -->
    <div class="stats">
      <div class="stat-card">
        <div id="statOrders">0</div>
        <small>Total Orders</small>
      </div>
      <div class="stat-card">
        <div id="statTotal">0</div>
        <small>Total Amount</small>
      </div>
      <div class="stat-card">
        <div id="statIncome">0</div>
        <small>Income</small>
      </div>
      <div class="stat-card">
        <div id="statExpense">0</div>
        <small>Expense</small>
      </div>
    </div>

    <!-- ACTIONS -->
    <div class="section-title">Actions</div>
    <div class="action-row">
      <button class="btn" onclick="openAddOrder()">â• Add Order</button>
      <button class="btn" onclick="openIncome()">â• Add Income</button>
      <button class="btn" onclick="openExpense()">â– Add Expense</button>
      <button class="btn" onclick="exportExcel()">ğŸ“¤ Export</button>
    </div>

    <!-- ORDERS -->
    <div class="section-title">Orders List</div>
    <div id="ordersList" class="list-box"></div>

    <!-- INCOME -->
    <div class="section-title">Income List</div>
    <div id="incomeList" class="list-box"></div>

    <!-- EXPENSE -->
    <div class="section-title">Expense List</div>
    <div id="expenseList" class="list-box"></div>

  </div>


  <!-- OVERLAY: ORDER -->
  <div id="overlay-order" class="overlay" style="display:none;">
    <div class="modal">
      <div class="big">Add Order</div>

      <div class="row">
        <label>Date</label>
        <input id="ordDate" type="date" />
      </div>

      <div class="row">
        <label>Customer Name</label>
        <input id="ordName" type="text" placeholder="Name" />
      </div>

      <div class="row">
        <label>Mobile</label>
        <input id="ordMobile" type="text" placeholder="Mobile" />
      </div>

      <div class="row">
        <label>Category</label>
        <select id="ordCategory"></select>
      </div>

      <div class="row">
        <label>Item</label>
        <input id="ordItem" type="text" placeholder="Item details" />
      </div>

      <div class="row">
        <label>Amount</label>
        <input id="ordAmount" type="number" placeholder="Amount" />
      </div>

      <div class="row">
        <label>Status</label>
        <select id="ordStatus">
          <option value="Pending">Pending</option>
          <option value="Done">Done</option>
          <option value="Cancel">Cancel</option>
        </select>
      </div>

      <div class="row">
        <label>Note</label>
        <input id="ordNote" type="text" placeholder="Note" />
      </div>

      <div class="row">
        <button class="btn" onclick="saveOrder()">âœ… Save</button>
        <button class="btn" onclick="document.getElementById('overlay-order').style.display='none'">Close</button>
      </div>
    </div>
  </div>


  <!-- OVERLAY: INCOME -->
  <div id="overlay-income" class="overlay" style="display:none;">
    <div class="modal">
      <div class="big">Add Income</div>

      <div class="row">
        <label>Date</label>
        <input id="incDate" type="date" />
      </div>

      <div class="row">
        <label>Title</label>
        <input id="incTitle" type="text" placeholder="Income title" />
      </div>

      <div class="row">
        <label>Amount</label>
        <input id="incAmount" type="number" placeholder="Amount" />
      </div>

      <div class="row">
        <label>Note</label>
        <input id="incNote" type="text" placeholder="Note" />
      </div>

      <div class="row">
        <button class="btn" onclick="saveIncome()">âœ… Save</button>
        <button class="btn" onclick="document.getElementById('overlay-income').style.display='none'">Close</button>
      </div>
    </div>
  </div>


  <!-- OVERLAY: EXPENSE -->
  <div id="overlay-expense" class="overlay" style="display:none;">
    <div class="modal">
      <div class="big">Add Expense</div>

      <div class="row">
        <label>Date</label>
        <input id="expDate" type="date" />
      </div>

      <div class="row">
        <label>Title</label>
        <input id="expTitle" type="text" placeholder="Expense title" />
      </div>

      <div class="row">
        <label>Amount</label>
        <input id="expAmount" type="number" placeholder="Amount" />
      </div>

      <div class="row">
        <label>Note</label>
        <input id="expNote" type="text" placeholder="Note" />
      </div>

      <div class="row">
        <button class="btn" onclick="saveExpense()">âœ… Save</button>
        <button class="btn" onclick="document.getElementById('overlay-expense').style.display='none'">Close</button>
      </div>
    </div>
  </div>


  <!-- OVERLAY: BUSINESS MANAGER -->
  <div id="overlay-biz" class="overlay" style="display:none;">
    <div class="modal">
      <div class="big">Business Manager</div>

      <div class="row">
        <label>New Business Name</label>
        <input id="newBizName" type="text" placeholder="Business name" />
      </div>

      <div class="row">
        <label>Owner Email</label>
        <input id="newBizOwnerEmail" type="email" placeholder="owner@gmail.com" />
      </div>

      <div class="row">
        <button class="btn" onclick="addBusiness()">â• Add Business</button>
        <button class="btn" onclick="deleteBusiness()">ğŸ—‘ Delete Selected</button>
      </div>

      <div class="row">
        <div style="font-size:12px;color:#666;margin-top:6px;">
          Owner Email match login email â‡’ only that business visible.
        </div>
      </div>

      <div class="row">
        <button class="btn" onclick="document.getElementById('overlay-biz').style.display='none'">Close</button>
      </div>
    </div>
  </div>


  <!-- OVERLAY: CATEGORY MANAGER -->
  <div id="overlay-cat" class="overlay" style="display:none;">
    <div class="modal">
      <div class="big">Category Manager</div>

      <div class="row">
        <label>New Category Name</label>
        <input id="newCatName" type="text" placeholder="Category name" />
      </div>

      <div class="row">
        <button class="btn" onclick="addCategory()">â• Add Category</button>
        <button class="btn" onclick="deleteCategory()">ğŸ—‘ Delete Selected</button>
      </div>

      <div class="row">
        <button class="btn" onclick="document.getElementById('overlay-cat').style.display='none'">Close</button>
      </div>
    </div>
  </div>


  <!-- SCRIPTS -->
  <script src="app.js"></script>
  <script src="gdrive.js"></script>

  <!-- âœ… PWA Service Worker Register (Fix mobile cache update issue) -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./service-worker.js");
    }

    window.addEventListener("load", () => {
      if (window.updateDriveStatusUI) window.updateDriveStatusUI();
    });
  </script>

</body>
</html>
