<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tatva OS Pro</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#263646" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <!-- TOP BAR -->
  <div class="topbar">
    <div class="left">
      <div class="brand">Tatva OS Pro</div>
      <div id="driveStatus" class="smalltext">Drive: âŒ Not connected</div>
    </div>

    <div class="right">
      <!-- âœ… Drive Login/Logout -->
      <button id="btnDriveLogin" class="btn-top" onclick="driveLogin()">ğŸ” Drive Login</button>
      <button id="btnDriveLogout" class="btn-top" style="display:none;" onclick="driveLogout()">ğŸšª Drive Logout</button>

      <button class="btn-top" onclick="backupToDrive(collectAppBackupData())">â˜ Backup</button>
      <button class="btn-top" onclick="restoreFromDrive()">â˜ Restore</button>

      <button class="btn-top" onclick="openBusinessMgr()">ğŸ¢ Business</button>
      <button class="btn-top" onclick="openCategoryMgr()">ğŸ—‚ Category</button>
    </div>
  </div>

  <!-- MAIN -->
  <div class="container">

    <!-- BUSINESS SELECT -->
    <div class="card">
      <div class="row">
        <div class="field">
          <label>Business</label>
          <select id="bizSelect" onchange="onBizChanged()"></select>
        </div>
        <div class="field">
          <label>Search</label>
          <input id="searchInput" type="text" placeholder="Search customer / mobile / item" oninput="renderAll()" />
        </div>
      </div>
    </div>

    <!-- SUMMARY -->
    <div class="grid2">
      <div class="card">
        <div class="big">Orders</div>
        <div class="row">
          <div class="stat">
            <div class="label">Total Orders</div>
            <div id="statOrders" class="value">0</div>
          </div>
          <div class="stat">
            <div class="label">Total Amount</div>
            <div id="statTotal" class="value">0</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="big">Net</div>
        <div class="row">
          <div class="stat">
            <div class="label">Income</div>
            <div id="statIncome" class="value">0</div>
          </div>
          <div class="stat">
            <div class="label">Expense</div>
            <div id="statExpense" class="value">0</div>
          </div>
          <div class="stat">
            <div class="label">Net</div>
            <div id="statNet" class="value">0</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ACTIONS -->
    <div class="card">
      <div class="row">
        <button class="btn" onclick="openAddOrder()">â• Add Order</button>
        <button class="btn" onclick="openIncome()">â• Add Income</button>
        <button class="btn" onclick="openExpense()">â– Add Expense</button>
        <button class="btn" onclick="exportExcel()">ğŸ“¤ Export</button>
      </div>
    </div>

    <!-- ORDERS LIST -->
    <div class="card">
      <div class="big">Orders List</div>
      <div id="ordersList" class="list"></div>
    </div>

    <!-- INCOME LIST -->
    <div class="card">
      <div class="big">Income List</div>
      <div id="incomeList" class="list"></div>
    </div>

    <!-- EXPENSE LIST -->
    <div class="card">
      <div class="big">Expense List</div>
      <div id="expenseList" class="list"></div>
    </div>

  </div>

  <!-- OVERLAY: ADD ORDER -->
  <div id="overlay-order" class="overlay" style="display:none;">
    <div class="modal">
      <div class="big">Add Order</div>

      <div class="row">
        <div class="field">
          <label>Date</label>
          <input id="ordDate" type="date" />
        </div>
        <div class="field">
          <label>Customer Name</label>
          <input id="ordName" type="text" placeholder="Name" />
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label>Mobile</label>
          <input id="ordMobile" type="text" placeholder="Mobile" />
        </div>
        <div class="field">
          <label>Category</label>
          <select id="ordCategory"></select>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label>Item</label>
          <input id="ordItem" type="text" placeholder="Item details" />
        </div>
        <div class="field">
          <label>Amount</label>
          <input id="ordAmount" type="number" placeholder="Amount" />
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label>Status</label>
          <select id="ordStatus">
            <option value="Pending">Pending</option>
            <option value="Done">Done</option>
            <option value="Cancel">Cancel</option>
          </select>
        </div>
        <div class="field">
          <label>Note</label>
          <input id="ordNote" type="text" placeholder="Note" />
        </div>
      </div>

      <div class="row">
        <button class="btn" onclick="saveOrder()">âœ… Save</button>
        <button class="btn" onclick="document.getElementById('overlay-order').style.display='none'">Close</button>
      </div>
    </div>
  </div>

  <!-- OVERLAY: INCOME -->
  <div id="overlay-income" class="overlay" style="display:none;">
    <div class="modal">
      <div class="big">Add Income</div>

      <div class="row">
        <div class="field">
          <label>Date</label>
          <input id="incDate" type="date" />
        </div>
        <div class="field">
          <label>Title</label>
          <input id="incTitle" type="text" placeholder="Income title" />
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label>Amount</label>
          <input id="incAmount" type="number" placeholder="Amount" />
        </div>
        <div class="field">
          <label>Note</label>
          <input id="incNote" type="text" placeholder="Note" />
        </div>
      </div>

      <div class="row">
        <button class="btn" onclick="saveIncome()">âœ… Save</button>
        <button class="btn" onclick="document.getElementById('overlay-income').style.display='none'">Close</button>
      </div>
    </div>
  </div>

  <!-- OVERLAY: EXPENSE -->
  <div id="overlay-expense" class="overlay" style="display:none;">
    <div class="modal">
      <div class="big">Add Expense</div>

      <div class="row">
        <div class="field">
          <label>Date</label>
          <input id="expDate" type="date" />
        </div>
        <div class="field">
          <label>Title</label>
          <input id="expTitle" type="text" placeholder="Expense title" />
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label>Amount</label>
          <input id="expAmount" type="number" placeholder="Amount" />
        </div>
        <div class="field">
          <label>Note</label>
          <input id="expNote" type="text" placeholder="Note" />
        </div>
      </div>

      <div class="row">
        <button class="btn" onclick="saveExpense()">âœ… Save</button>
        <button class="btn" onclick="document.getElementById('overlay-expense').style.display='none'">Close</button>
      </div>
    </div>
  </div>

  <!-- OVERLAY: BUSINESS MANAGER -->
  <div id="overlay-biz" class="overlay" style="display:none;">
    <div class="modal wide">
      <div class="big">Business Manager</div>

      <div class="row">
        <div class="field">
          <label>New Business Name</label>
          <input id="newBizName" type="text" placeholder="Business name" />
        </div>
        <div class="field">
          <label>Owner Email</label>
          <input id="newBizOwnerEmail" type="email" placeholder="owner@gmail.com" />
        </div>
      </div>

      <div class="row">
        <button class="btn" onclick="addBusiness()">â• Add Business</button>
        <button class="btn" onclick="deleteBusiness()">ğŸ—‘ Delete Selected</button>
      </div>

      <div class="note">
        <div class="smalltext">
          Owner Email match login email â‡’ only that business visible.
        </div>
      </div>

      <div class="row">
        <button class="btn" onclick="document.getElementById('overlay-biz').style.display='none'">Close</button>
      </div>
    </div>
  </div>

  <!-- OVERLAY: CATEGORY MANAGER -->
  <div id="overlay-cat" class="overlay" style="display:none;">
    <div class="modal wide">
      <div class="big">Category Manager</div>

      <div class="row">
        <div class="field">
          <label>New Category Name</label>
          <input id="newCatName" type="text" placeholder="Category name" />
        </div>
      </div>

      <div class="row">
        <button class="btn" onclick="addCategory()">â• Add Category</button>
        <button class="btn" onclick="deleteCategory()">ğŸ—‘ Delete Selected</button>
      </div>

      <div class="row">
        <button class="btn" onclick="document.getElementById('overlay-cat').style.display='none'">Close</button>
      </div>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script src="app.js"></script>
  <script src="gdrive.js"></script>

  <!-- âœ… PWA Service Worker Register (Fix update issue on phone) -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./service-worker.js");
    }

    // Update UI at load
    window.addEventListener("load", () => {
      if (window.updateDriveStatusUI) window.updateDriveStatusUI();
    });
  </script>

</body>
</html>
